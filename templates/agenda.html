<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Agenda - RafahMed</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css">
  <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      background-color: #f9f9f9;
    }

    .top-menu {
      background-color: white;
      padding: 10px 0;
      display: flex;
      justify-content: center;
      gap: 20px;
      border-bottom: 1px solid #eee;
    }

    .top-menu a {
      font-weight: 500;
      font-size: 14px;
      color: #000000;
      text-decoration: none;
      padding: 8px 12px;
      border-radius: 6px;
      transition: 0.3s;
    }

    .top-menu a:hover {
      background-color: #dd1b35;
      color: white;
    }

    .logo-img {
      width: 100px;
      display: block;
      margin: 0 auto 20px auto;
    }

    h2 {
      text-align: center;
      font-size: 26px;
      color: #2c3e50;
      margin-bottom: 30px;
    }

    #calendar {
      margin-top: 30px;
      font-family: 'Montserrat', sans-serif;
    }

    .fc .fc-toolbar-title {
      font-size: 20px;
      font-weight: 600;
      color: #2c3e50;
    }

    .fc-button {
      background-color: white !important;
      color: #000000 !important;
      border: 2px solid #dd1b35 !important;
      border-radius: 6px !important;
      font-size: 13px !important;
      font-weight: 500 !important;
      font-family: 'Montserrat', sans-serif !important;
      transition: 0.3s ease;
    }

    .fc-button:hover {
      background-color: #dd1b35 !important;
      color: white !important;
    }

    .fc-daygrid-event {
      background-color: #dd1b35 !important;
      border: none !important;
      font-size: 12px !important;
      padding: 4px;
      border-radius: 4px;
      font-family: 'Montserrat', sans-serif;
    }

    .fc .fc-daygrid-day-number {
      font-size: 13px;
      color: #000000;
    }

    .fc .fc-col-header-cell-cushion {
      font-size: 13px;
      font-weight: 500;
      color: #000000;
    }

    .add-button {
      display: block;
      margin: 0 auto 20px auto;
      background-color: #ffffff;
      color: #000000;
      border: 2px solid #dd1b35;
      padding: 10px 20px;
      border: none;
      font-weight: 500;
      border-radius: 6px;
      text-decoration: none;
      transition: background-color 0.3s ease;
      text-align: center;
      cursor: pointer;
    }

    .add-button:hover {
      background-color: #009fb0;
    }

    .menu-button {
      font-family: 'Montserrat', sans-serif;
      font-size: 14px;
      font-weight: 500;
      color: #000000;
      border: 2px solid #dd1b35;
      background-color: white;
      padding: 10px 16px;
      border-radius: 6px;
      text-decoration: none;
      transition: 0.3s ease;
      cursor: pointer;
    }

    .menu-button:hover {
      background-color: #dd1b35;
      color: white;
    }

    .content {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
    }

    .header {
      text-align: center;
      margin-bottom: 10px;
    }

    .header h2 {
      font-size: 26px;
      color: #2c3e50;
      margin: 0;
    }
  </style>
</head>

<body>
  <div class="top-menu">
    <div style="position: absolute; left: 20px;">
      <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="Logo" style="height: 40px;">
    </div>
    <a href="{{ url_for('index') }}">Início</a>
    <a href="{{ url_for('upload') }}">Ponza Lab</a>
    <a href="{{ url_for('quiz_results') }}">Autoavaliações</a>
    <a href="{{ url_for('quote_index') }}">Cotações</a>
    <a href="{{ url_for('catalog') }}">Pacientes</a>
    <a href="{{ url_for('products') }}">Estoque</a>
    <a href="{{ url_for('agenda') }}">Agenda</a>
    <a href="{{ url_for('logout') }}">Sair</a>
  </div>

  <div class="content">
    <a href="{{ url_for('index') }}">
      <img src="{{ url_for('static', filename='images/logo.png') }}" class="logo-img" alt="Logo RafahMed">
    </a>
  </div>

  <div style="text-align: center; margin: 20px 0;">
    <button onclick="openModal()" class="menu-button">Agendar Consulta</button>
  </div>

  <div id="calendar" style="padding: 0 30px;"></div>
<!-- MODAL DE CONSULTA SIMPLIFICADO -->
<div id="eventModal"
  style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; font-family: 'Montserrat', sans-serif;">
  <div
    style="background:white; padding:30px; border-radius:8px; width:90%; max-width:500px; text-align:center; color:#000000; position: relative;">
    <!-- Botão X -->
    <button onclick="closeModal()" style="
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 22px;
      font-weight: bold;
      color: #000000;
      cursor: pointer;
      transition: color 0.3s ease;
    " onmouseover="this.style.color='#dd1b35';" onmouseout="this.style.color='#000000';">
      ×
    </button>

    <h3 style="margin-bottom: 20px;">Agendar Consulta</h3>

    <!-- Nome do paciente -->
    <input type="text" id="title" placeholder="Nome do Paciente" required
      style="width:95%; padding:10px 12px; border:1px solid #ccc; border-radius:6px; margin-bottom:15px; font-family:'Montserrat', sans-serif; font-size:14px; color:#000000; outline: none;"
      onfocus="this.style.border='1px solid #dd1b35';"
      onblur="this.style.border='1px solid #ccc';">

    <!-- Data com calendário -->
    <input type="date" id="date" required
      style="width:95%; padding:10px 12px; border:1px solid #ccc; border-radius:6px; margin-bottom:15px; font-family:'Montserrat', sans-serif; font-size:14px; color:#000000; outline: none;"
      onfocus="this.style.border='1px solid #dd1b35';"
      onblur="this.style.border='1px solid #ccc';"
      onchange="formatDateForDisplay(this)">

    <!-- Hora opcional -->
    <input type="time" id="time"
      style="width:95%; padding:10px 12px; border:1px solid #ccc; border-radius:6px; margin-bottom:20px; font-family:'Montserrat', sans-serif; font-size:14px; color:#000000; outline: none;"
      onfocus="this.style.border='1px solid #dd1b35';"
      onblur="this.style.border='1px solid #ccc';">

    <!-- Botão de salvar -->
    <button onclick="submitEvent()" style="
      font-family: 'Montserrat', sans-serif;
      width: 100%;
      padding: 12px;
      background-color: white;
      color: #000000;
      border: 2px solid #dd1b35;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease;
    " onmouseover="this.style.backgroundColor='#dd1b35'; this.style.color='white';"
      onmouseout="this.style.backgroundColor='white'; this.style.color='#000000';">
      Salvar
    </button>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'pt-br',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
      },
      events: '/api/events',  // <-- Aqui está o ponto chave
      eventTimeFormat: {
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      },
      dayHeaderFormat: {
        weekday: 'short'
      },
      titleFormat: {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit'
      }
    });
    calendar.render();
  });

  function openModal() {
    document.getElementById("eventModal").style.display = "flex";
  }

  function closeModal() {
    document.getElementById("eventModal").style.display = "none";
  }

  function submitEvent() {
  const title = document.getElementById("title").value;
  const dateInput = document.getElementById("date").value;
  const time = document.getElementById("time").value || "00:00";

  if (!title || !dateInput) {
    alert("Preencha o nome e a data.");
    return;
  }

  const [year, month, day] = dateInput.split("-");
  const formattedDate = `${day}/${month}/${year}`; // dd/mm/aaaa

  const form = new FormData();
  form.append("title", title);
  form.append("date", formattedDate);
  form.append("time", time);

  fetch("/submit_consultation", {
    method: "POST",
    body: form
  })
    .then(() => {
      alert("Consulta agendada com sucesso!");
      closeModal();
      location.reload();
    })
    .catch(() => alert("Erro ao salvar consulta."));
}

</script>
</body>

</html>