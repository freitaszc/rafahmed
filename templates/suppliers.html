<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Cadastro de Fornecedores - RafahMed</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/web.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background-color: #f9f9f9;
        }

        .top-menu {
            background-color: white;
            padding: 10px 0;
            display: flex;
            justify-content: center;
            gap: 20px;
            border-bottom: 1px solid #eee;
        }

        .top-menu a {
            font-weight: 500;
            font-size: 14px;
            color: #000000;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 6px;
            transition: 0.3s;
        }

        .top-menu a:hover {
            background-color: #dd1b35;
            color: white;
        }

        .content {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }

        h2 {
            font-size: 26px;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .menu-button {
            font-size: 14px;
            font-weight: 500;
            color: #000000;
            border: 2px solid #dd1b35;
            background-color: white;
            padding: 10px 16px;
            border-radius: 6px;
            text-decoration: none;
            transition: 0.3s ease;
            cursor: pointer;
        }

        .menu-button:hover {
            background-color: #dd1b35;
            color: white;
        }

        .catalog-table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
        }

        .catalog-table th,
        .catalog-table td {
            padding: 12px 14px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }

        .catalog-table th {
            background-color: #f5f5f5;
            font-weight: 600;
            color: #2c3e50;
        }

        .options-container {
            position: relative;
            display: inline-block;
        }

        .options-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }

        .options-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 30px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            min-width: 160px;
            z-index: 100;
        }

        .options-menu a {
            display: block;
            padding: 10px 12px;
            text-decoration: none;
            color: #000000;
            font-size: 14px;
        }

        .options-menu a:hover {
            background-color: #dd1b35;
            color: white;
        }

        .delete-button {
            background: none;
            border: none;
            padding: 10px 12px;
            width: 100%;
            text-align: left;
            font-size: 14px;
            color: #000000;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .delete-button:hover {
            background-color: #dd1b35;
            color: white;
        }
    </style>
</head>

<body>
    <div class="top-menu">
        <div style="position: absolute; left: 20px;">
            <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="Logo" style="height: 40px;">
        </div>
        <a href="{{ url_for('index') }}">Início</a>
        <a href="{{ url_for('upload') }}">Ponza Lab</a>
        <a href="{{ url_for('quote_index') }}">Cotações</a>
        <a href="{{ url_for('catalog') }}">Pacientes</a>
        <a href="{{ url_for('products') }}">Estoque</a>
        <a href="{{ url_for('agenda') }}">Agenda</a>
        <a href="{{ url_for('logout') }}">Sair</a>
    </div>

    <div class="content">
        <h2>Cadastro de Fornecedores</h2>
        <a href="#" class="menu-button" onclick="openModal()">Cadastrar Fornecedor</a>

        <table class="catalog-table">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Telefone</th>
                    <th>Email</th>
                    <th>Opções</th>
                </tr>
            </thead>
            <tbody>
                {% for supplier in suppliers %}
                <tr>
                    <td>{{ supplier.name }}</td>
                    <td>{{ supplier.phone }}</td>
                    <td>{{ supplier.email }}</td>
                    <td>
                        <div style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                            <div class="options-container">
                                <button class="options-button" onclick="toggleMenu(this)">⋮</button>
                                <div class="options-menu">
                                    <a href="#"
                                        onclick="openEditModal('{{ supplier.id }}', '{{ supplier.name }}', '{{ supplier.phone }}', '{{ supplier.email }}')">Editar</a>
                                </div>
                            </div>
                            <form method="post" action="{{ url_for('delete_supplier', supplier_id=supplier.id) }}"
                                onsubmit="return confirm('Deseja realmente excluir este fornecedor?')"
                                style="margin: 0;">
                                <button type="submit" title="Excluir"
                                    style="background: none; border: none; font-size: 18px; font-weight: bold; color: #999; cursor: pointer;">×</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- MODAL para cadastrar fornecedor -->
    <div id="addSupplierModal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
        <div style="background:white; padding:20px; border-radius:10px; width:90%; max-width:300px; position:relative;">
            <!-- Botão X no topo -->
            <button onclick="closeModal()" style="
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 22px;
      font-weight: bold;
      color: #000000;
      cursor: pointer;
      transition: color 0.3s ease;
    " onmouseover="this.style.color='#dd1b35';" onmouseout="this.style.color='#000000';">×</button>

            <h2 style="text-align:center; margin-top: 10px;">Cadastrar Fornecedor</h2>
            <form method="post" action="{{ url_for('add_supplier') }}">
                <input type="text" name="name" placeholder="Nome do Fornecedor" required
                    style="width:93%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-bottom:10px; font-size:14px; font-family:'Montserrat', sans-serif;">
                <input type="text" name="phone" placeholder="Telefone" required
                    style="width:93%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-bottom:10px; font-size:14px; font-family:'Montserrat', sans-serif;">
                <input type="email" name="email" placeholder="E-mail" required
                    style="width:93%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-bottom:10px; font-size:14px; font-family:'Montserrat', sans-serif;">
                <div style="display:flex; justify-content:center;">
                    <button type="submit" class="menu-button" style="width: 100%;">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL para editar fornecedor -->
    <div id="editSupplierModal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
        <div style="background:white; padding:20px; border-radius:10px; width:90%; max-width:300px; position:relative;">
            <!-- Botão X no topo -->
            <button onclick="closeEditModal()" style="
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 22px;
      font-weight: bold;
      color: #000000;
      cursor: pointer;
      transition: color 0.3s ease;
    " onmouseover="this.style.color='#dd1b35';" onmouseout="this.style.color='#000000';">×</button>

            <h2 style="text-align:center; margin-top: 10px;">Editar Fornecedor</h2>
            <form method="post" id="editSupplierForm">
                <input type="text" name="name" id="editSupplierName" required
                    style="width:93%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-bottom:10px; font-size:14px; font-family:'Montserrat', sans-serif;">
                <input type="text" name="phone" id="editSupplierPhone" required
                    style="width:93%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-bottom:10px; font-size:14px; font-family:'Montserrat', sans-serif;">
                <input type="email" name="email" id="editSupplierEmail" required
                    style="width:93%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-bottom:10px; font-size:14px; font-family:'Montserrat', sans-serif;">
                <div style="display:flex; justify-content:center;">
                    <button type="submit" class="menu-button" style="width: 100%;">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function openModal() {
            document.getElementById('addSupplierModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('addSupplierModal').style.display = 'none';
        }

        function toggleMenu(button) {
            const menu = button.nextElementSibling;
            document.querySelectorAll('.options-menu').forEach(m => m.style.display = 'none');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        function openEditModal(id, name, phone, email) {
            document.getElementById('editSupplierName').value = name;
            document.getElementById('editSupplierPhone').value = phone;
            document.getElementById('editSupplierEmail').value = email;
            document.getElementById('editSupplierForm').action = `/update_supplier/${id}`;
            document.getElementById('editSupplierModal').style.display = 'flex';
        }

        function closeEditModal() {
            document.getElementById('editSupplierModal').style.display = 'none';
        }

        window.onclick = function (event) {
            document.querySelectorAll('.options-container').forEach(container => {
                if (!container.contains(event.target)) {
                    const menu = container.querySelector('.options-menu');
                    if (menu) menu.style.display = 'none';
                }
            });
        };
    </script>
</body>

</html>